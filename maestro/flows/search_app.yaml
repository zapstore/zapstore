appId: dev.zapstore.app
---
# =============================================================
# Sub-flow: Search for an app and open its detail page
#
# Env vars:
#   APP_SEARCH_TERM  - Text to type in the search field
#   APP_MATCH_TEXT   - Regex to match the search result card
#                      (use ".*partial text.*" for multi-line)
#
# After completion, the app detail page is visible.
# =============================================================

# Dismiss Android notification permission dialog if shown
- runFlow:
    when:
      visible: "Allow"
    commands:
      - tapOn: "Allow"

# Wait for the app to be ready (tab bar visible)
- extendedWaitUntil:
    visible:
      text: ".*Tab 1 of 3"
    timeout: 20000

# Ensure we're on the Search tab root
- tapOn:
    text: ".*Tab 1 of 3"
    label: "Tap Search tab"
- tapOn:
    text: ".*Tab 1 of 3"
    label: "Tap Search tab again to reset"

- waitForAnimationToEnd

# Clear any previous search state
- runFlow:
    when:
      visible: "Clear search"
    commands:
      - tapOn: "Clear search"

- extendedWaitUntil:
    visible: "Search apps"
    timeout: 20000

- tapOn: "Search apps"
- inputText: "${APP_SEARCH_TERM}"
- pressKey: Enter

- extendedWaitUntil:
    visible:
      text: "${APP_MATCH_TEXT}"
    timeout: 20000

- tapOn:
    text: "${APP_MATCH_TEXT}"
    label: "Tap search result"

- waitForAnimationToEnd
