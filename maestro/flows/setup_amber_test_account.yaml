appId: com.greenart7c3.nostrsigner
---
# =============================================================
# Sub-flow: Ensure test account is active in Amber
#
# Handles three scenarios:
#   A) Amber main screen ("Applications") → open Accounts tab
#   B) Fresh Amber (onboarding) → import from nsec directly
#   C) Already on account selector → pick or import
#
# Test account npub (truncated): npub1lhr
#
# Environment variable required:
#   NOSTR_TEST_NSEC — the nsec to import
#
# Prerequisites:
#   - Amber signer app installed on the device
#   - Device language set to English
# =============================================================

# Wait for Amber to load (main screen or onboarding)
- assertVisible:
    text: "(?:Applications|Use your private key|Select Account)"

# ─── Scenario A: main screen with accounts (title = "Applications") ───
- runFlow:
    when:
      visible: "Applications"
    commands:
      - tapOn:
          text: "Accounts"
          label: "Tap Accounts bottom tab"
      - assertVisible: "Select Account"
      # Import test account if not present
      - runFlow:
          when:
            notVisible: "npub1lhr"
          commands:
            - tapOn: "Add New Account"
            - assertVisible: "Use your private key"
            - tapOn: "Use your private key"
            - assertVisible: "Nsec / private key"
            - tapOn:
                text: "Nsec / private key"
                label: "Tap nsec input field"
            - inputText: "${NOSTR_TEST_NSEC}"
            - tapOn: "Next"
            - assertVisible: "Finish"
            - tapOn: "Finish"
            - assertVisible:
                text: "(?:Allow Amber|Applications)"
            - runFlow:
                when:
                  visible: "Allow"
                commands:
                  - tapOn: "Allow"
            - assertVisible: "Applications"
      # If account sheet is still open (account existed), select it
      - runFlow:
          when:
            visible: "Select Account"
          commands:
            - tapOn:
                text: "npub1lhr"
                label: "Select test account"
            - pressKey: back

# ─── Scenario B: fresh Amber onboarding ───
- runFlow:
    when:
      visible: "Use your private key"
    commands:
      - tapOn: "Use your private key"
      - assertVisible: "Nsec / private key"
      - tapOn:
          text: "Nsec / private key"
          label: "Tap nsec input field"
      - inputText: "${NOSTR_TEST_NSEC}"
      - tapOn: "Next"
      - assertVisible: "Finish"
      - tapOn: "Finish"
      - assertVisible:
          text: "(?:Allow Amber|Applications)"
      - runFlow:
          when:
            visible: "Allow"
          commands:
            - tapOn: "Allow"
      - assertVisible: "Applications"
