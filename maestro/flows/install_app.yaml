appId: dev.zapstore.app
---
# =============================================================
# Sub-flow: Install app from its detail page
#
# Expects to be on the app detail page with the app NOT installed.
# Taps Install, handles system dialogs, waits for completion.
#
# Handles:
#   - Amber signing request (if prompted)
#   - Samsung "Trust and install app" security dialog (if prompted)
#   - Android system "Install" dialog
#   - Samsung "package analysis error" dialog (dismiss OK, install still succeeds)
#
# After completion, the app is installed ("Open" visible).
# =============================================================

- tapOn: "Install"

# Android system may show its own "Update" dialog for reinstalls
- runFlow:
    when:
      visible: "Update"
    commands:
      - tapOn: "Update"

# Amber may ask to sign a request during install
- runFlow:
    when:
      visible: "Accept"
    commands:
      - tapOn: "Accept"

# Samsung security dialog (may not appear if source already trusted)
- runFlow:
    when:
      visible: "Trust and install app"
    commands:
      - tapOn: "Trust and install app"

# Android system install dialog
- assertVisible: "Install"
- tapOn: "Install"

# Wait for either "Open" (success) or Samsung "package analysis error" dialog.
# The dialog covers "Open" so we must detect and dismiss it first.
- extendedWaitUntil:
    visible:
      text: "(?:Open|OK)"
    timeout: 45000

# Dismiss Samsung dialog if it appeared
- runFlow:
    when:
      visible: "OK"
    commands:
      - tapOn: "OK"

# Confirm install completed
- assertVisible: "Open"
